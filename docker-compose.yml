version: "3.7"
services:
    php:
        build:
            context: ./docker
            target: api_platform_php
            # <<: *api-cache-from
        image: ${PHP_IMAGE:-quay.io/api-platform/php}
        healthcheck:
            interval: 10s
            timeout: 3s
            retries: 3
            start_period: 30s
        depends_on:
            - db
        volumes:
            - ./:/srv/api:rw,cached
            - ./docker/php/api-platform.prod.ini:/usr/local/etc/php/conf.d/api-platform.ini
            # if you develop on Linux, you may use a bind-mounted host directory instead
            # - ./api/var:/srv/api/var:rw
            # - dev-certs:/certs:ro,nocopy
    api:
        build:
            context: ./docker
            target: api_platform_nginx
            # <<: *api-cache-from
        image: ${NGINX_IMAGE:-quay.io/api-platform/nginx}
        depends_on:
            - php
        volumes:
            - ./public:/srv/api/public:ro
    db:
        image: 'mysql'
        environment:
            - MYSQL_ROOT_PASSWORD=d9s37Kg3PFHhs975
            - MYSQL_USER=api-user
            - MYSQL_PASSWORD=DaY7t9MH4PLJTCZC
            - MYSQL_DATABASE=api
        ports:
          - target: 3306
            published: 3306
            protocol: tcp